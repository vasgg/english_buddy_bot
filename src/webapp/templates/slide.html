{% extends "base.html" %}
{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–∞–∏ÃÜ–¥–∞{% endblock %}
{% block content %}

<div class="container mt-4">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–∞–π–¥–∞</h2>

    <h4>
        lesson {{ lesson.id }} / {{ lesson.title.lower() }} / slide {{ slide.id }}
        {% if slide.slide_type.value == 'text' %} üñãÔ∏è
        {% elif slide.slide_type.value == 'image' %} üñºÔ∏è
        {% elif slide.slide_type.value == 'pin_dict' %} üìé
        {% elif slide.slide_type.value == 'small_sticker' %} üß®
        {% elif slide.slide_type.value == 'big_sticker' %} üí£
        {% elif slide.slide_type.value == 'quiz_options' %} üß©
        {% elif slide.slide_type.value == 'quiz_input_word' %} üó®Ô∏è
        {% elif slide.slide_type.value == 'quiz_input_phrase' %} üí¨
        {% elif slide.slide_type.value == 'final_slide' %} üéâ
        {% endif %}</h4>
    <p></p>
    <form id="editSlideForm" action="/slides/{{ slide.id }}" method="post" enctype="multipart/form-data">
        <table class="table">
            <tr>
                <th>Slide ID</th>
                <td><input type="text" class="form-control" data-slideId="{{ slide.id }}" name="slide_id" value="{{ slide.id }}" readonly></td>
            </tr>
            <tr>
                <th>Next slide ID</th>
                <td><input type="text" class="form-control" name="next_slide" value="{{ slide.next_slide }}"></td>
            </tr>
            <tr>
                <th>Slide type</th>
                <td><input type="text" class="form-control" name="slide_type" value="{{ slide.slide_type }}" readonly></td>
            </tr>

            {% if slide.slide_type.value == 'text' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text">{{ slide.text }}</textarea></td>
            </tr>
            <tr>
                <th>Delay</th>
                <td><input type="number" class="form-control" name="delay" value="{{ slide.delay }}"></td>
            </tr>
            <tr>
                <th>Further button</th>
                <td><input type="checkbox" name="further_button" value="true" {{ 'checked' if slide.keyboard_type.value == 'further' else '' }}></td>
            </tr>
            {% elif slide.slide_type.value == 'image' %}
            <tr>
                <th>Image name</th>
                <td>
                    <select class="form-control" name="picture" onchange="updateImagePreview(this)">
                        {% for file in files %}
                        <option value="{{ file }}" {{
                        'selected' if file == slide.picture else '' }}>{{ file }}</option>
                        {% endfor %}
                    </select>
                </td>
            </tr>
            <tr>
                <th>Image</th>
                <td><img id="selectedImage" src="/static/images/lesson_{{ slide.lesson_id }}/{{ slide.picture }}" alt="{{ slide.picture }}"></td>
                <!--                <td><img src="/static/images/lesson_{{ slide.lesson_id }}/{{ slide.picture }}" alt="{{ slide.picture }}"></td>-->
            </tr>
            <tr>
            <tr>
                <th>Upload New Image</th>
                <td><input type="file" class="form-control-file" name="new_picture"
                           accept="image/png, image/jpeg, image/gif, image/heic, image/tiff, image/webp">
                </td>
            </tr>
            <tr>
                <th>Delay</th>
                <td><input type="number" class="form-control" name="delay" value="{{ slide.delay }}"></td>
            </tr>
            <tr>
                <th>Further button</th>
                <td><input type="checkbox" name="further_button" value="true" {{ 'checked' if slide.keyboard_type.value == 'further' else '' }}></td>
            </tr>
            {% elif slide.slide_type.value == 'pin_dict' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text">{{ slide.text }}</textarea></td>
            </tr>
            {% elif slide.slide_type.value == 'quiz_options' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text">{{ slide.text }}</textarea></td>
            </tr>
            <tr>
                <th>Right answer</th>
                <td><input type="text" class="form-control" name="right_answers" value="{{ slide.right_answers }}"></td>
            </tr>
            <tr>
                <th>Keyboard</th>
                <td><input type="text" class="form-control" name="keyboard" value="{{ slide.keyboard }}"></td>
            </tr>
            <tr>
                <th>Is exam slide</th>
                <td><input type="checkbox" name="is_exam_slide" value="true" {{ 'checked' if slide.is_exam_slide else '' }}></td>
            </tr>
            {% elif slide.slide_type.value == 'quiz_input_word' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text">{{ slide.text }}</textarea></td>

            </tr>
            <tr>
                <th>Right answer</th>
                <td><input type="text" class="form-control" name="right_answers" value="{{ slide.right_answers }}"></td>
            </tr>
            <tr>
                <th>Is exam slide</th>
                <td><input type="checkbox" name="is_exam_slide" value="true" {{ 'checked' if slide.is_exam_slide else '' }}></td>
            </tr>
            {% elif slide.slide_type.value == 'quiz_input_phrase' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text">{{ slide.text }}</textarea></td>

            </tr>
            <tr>
                <th>Right answers</th>
                <td><input type="text" class="form-control" name="right_answers" value="{{ slide.right_answers }}"></td>
            </tr>
            <tr>
                <th>Almost right answers</th>
                <td><input type="text" class="form-control" name="almost_right_answers" value="{{ slide.almost_right_answers }}"></td>
            </tr>
            <tr>
                <th>Almost right answers reply</th>
                <td><textarea class="form-control" name="almost_right_answer_reply">{{ slide.almost_right_answer_reply }}</textarea></td>
            </tr>
            <tr>
                <th>Is exam slide</th>
                <td><input type="checkbox" name="is_exam_slide" value="true" {{ 'checked' if slide.is_exam_slide else '' }}></td>
            </tr>
            {% elif slide.slide_type.value == 'final_slide' %}
            <tr>
                <th>Text</th>
                <td><textarea class="form-control" name="text" rows="4">{{ slide.text }}</textarea></td>
            </tr>
            {% endif %}
        </table>

    </form>

</div>

{% endblock %}
{% block sidebar_content %}
<div class=sidebar__button-wrapper">

</div>
<div class="sidebar__button-wrapper">
    <button class="btn btn-primary" onclick="showSlides({{ lesson.id }})">–°–ª–∞–π–¥—ã</button>
    <div class="sidebar__arrow-buttons">
        <button class="btn btn-primary SwitchSlideButton" {% if not previous_slide %}disabled{% endif %} data-link-slide="{{previous_slide.id}}">
            ‚Üê
        </button>
        <button class="btn btn-primary SwitchSlideButton" {% if slide.slide_type.value=='final_slide' %}disabled{% endif %}
                data-link-slide="{{slide.next_slide}}">
            ‚Üí
        </button>
    </div>

    <button type="button" class="btn btn-success" onclick="saveSlide({{ slide.id }})">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

</div>
<script>
    function updateImagePreview(selectElement) {
        const lessonId = {{ slide.lesson_id }}; // –ü–æ–ª—É—á–∏—Ç–µ ID —É—Ä–æ–∫–∞, –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É —á–∞—Å—Ç—å
        const selectedFileName = selectElement.value; // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ select
        const imagePath = `/static/images/lesson_${lessonId}/${selectedFileName}`; // –°–æ—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –Ω–æ–≤–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
        document.getElementById('selectedImage').src = imagePath; // –û–±–Ω–æ–≤–ª—è–µ–º src –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    }
</script>
{% endblock %}

